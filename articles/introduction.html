<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="RBesT">
<title>Getting started with RBesT (binary) • RBesT</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with RBesT (binary)">
<meta property="og:description" content="RBesT">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">RBesT</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7-0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/PoS_codata.html">Probability of Success with Co-Data</a>
    <a class="dropdown-item" href="../articles/PoS_interim.html">Probability of Success at an Interim Analysis</a>
    <a class="dropdown-item" href="../articles/customizing_plots.html">Customizing RBesT plots</a>
    <a class="dropdown-item" href="../articles/introduction.html">Getting started with RBesT (binary)</a>
    <a class="dropdown-item" href="../articles/introduction_normal.html">RBesT for a Normal Endpoint</a>
    <a class="dropdown-item" href="../articles/variances_MAP.html">Meta-Analytic-Predictive Priors for Variances</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Novartis/RBesT/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Getting started with RBesT (binary)</h1>
                        <h4 data-toc-skip class="author">Sebastian
Weber</h4>
            
            <h4 data-toc-skip class="date">2023-07-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Novartis/RBesT/blob/HEAD/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="d-none name"><code>introduction.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The R Bayesian evidence synthesis Tools (RBesT) have been created to
facilitate the use of historical information in clinical trials. Once
relevant historical information has been identified, RBesT supports the
derivation of informative priors via the Meta-Analytic-Predictive (MAP)
approach [1] and the evaluation of the trial’s operating
characteristics. The MAP approach performs a standard meta-analysis
followed by a prediction for the control group parameter of a future
study while accounting for the uncertainty in the population mean (the
standard result from a meta-analysis) and the between-trial
heterogeneity. Therefore, RBesT can also be used as a meta-analysis tool
if one simply neglects the prediction part.</p>
<p>Let’s consider a Novartis Phase II study in ankylosing spondylitis
comparing the Novartis test treatment secukinumab with placebo [2]. The
primary efficacy endpoint was percentage of patients with a 20% response
according to the Assessment of SpondyloArthritis international Society
criteria for improvement (ASAS20) at week 6. For the control group, the
following historical data were used to derive the MAP prior:</p>
<table class="table">
<thead><tr class="header">
<th align="left">study</th>
<th align="right">n</th>
<th align="right">r</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Study 1</td>
<td align="right">107</td>
<td align="right">23</td>
</tr>
<tr class="even">
<td align="left">Study 2</td>
<td align="right">44</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">Study 3</td>
<td align="right">51</td>
<td align="right">19</td>
</tr>
<tr class="even">
<td align="left">Study 4</td>
<td align="right">39</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">Study 5</td>
<td align="right">139</td>
<td align="right">39</td>
</tr>
<tr class="even">
<td align="left">Study 6</td>
<td align="right">20</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">Study 7</td>
<td align="right">78</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">Study 8</td>
<td align="right">35</td>
<td align="right">10</td>
</tr>
</tbody>
</table>
<p>This dataset is part of RBesT and available after loading the package
in the data frame <code>AS</code>.</p>
<p>RBesT supports all required steps to design a clinical trial with
historical information using the MAP approach.</p>
</div>
<div class="section level2">
<h2 id="prior-derivation">Prior Derivation<a class="anchor" aria-label="anchor" href="#prior-derivation"></a>
</h2>
<div class="section level3">
<h3 id="meta-analytic-predictive-analysis">Meta-Analytic-Predictive Analysis<a class="anchor" aria-label="anchor" href="#meta-analytic-predictive-analysis"></a>
</h3>
<p>The <strong><code>gMAP</code></strong> function performs the
meta-analysis and the prediction, which yields the MAP prior. The
analysis is run using stochastic Markov-Chain-Monte-Carlo with Stan. In
order to make results exactly reproducible, the <code>set.seed</code>
function must be called prior to calling
<strong><code>gMAP</code></strong> .</p>
<p>A key parameter in a meta-analysis is the between-trial heterogeneity
parameter <span class="math inline">\(\tau\)</span> which controls the
amount of borrowing from historical information for the estimation of
the population mean will occur. As we often have only few historical
trials, the prior is important. For binary endpoints with an expected
response rate of 20%-80% we recommend a conservative
<code>HalfNormal(0,1)</code> prior as a default. Please refer to the
help-page of <strong><code>gMAP</code></strong> for more
information.</p>
<p>The <strong><code>gMAP</code></strong> function returns an analysis
object from which we can extract information using the functions from
RBesT. We do recommend to look at the graphical model checks provided by
RBesT as demonstrated below. The most important one is the forest plot,
with solid lines for the MAP model predictions and dashed lines for the
stratified estimates. For a standard forest plot without the shrinkage
estimates please refer to the <code>forest_plot</code> function in
RBesT.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load R packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://opensource.nibr.com/RBesT/">RBesT</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># sets up plotting theme</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">34563</span><span class="op">)</span></span>
<span><span class="va">map_mcmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gMAP.html">gMAP</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">r</span>, <span class="va">n</span><span class="op">-</span><span class="va">r</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">study</span>,</span>
<span>                 data<span class="op">=</span><span class="va">AS</span>,</span>
<span>                 tau.dist<span class="op">=</span><span class="st">"HalfNormal"</span>,</span>
<span>                 tau.prior<span class="op">=</span><span class="fl">1</span>,</span>
<span>                 beta.prior<span class="op">=</span><span class="fl">2</span>,</span>
<span>                 family<span class="op">=</span><span class="va">binomial</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Assuming default prior location   for beta: 0</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">map_mcmc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Generalized Meta Analytic Predictive Prior Analysis</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:  gMAP(formula = cbind(r, n - r) ~ 1 | study, family = binomial, </span></span>
<span><span class="co">##     data = AS, tau.dist = "HalfNormal", tau.prior = 1, beta.prior = 2)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Exchangeability tau strata: 1 </span></span>
<span><span class="co">## Prediction tau stratum    : 1 </span></span>
<span><span class="co">## Maximal Rhat              : 1 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Between-trial heterogeneity of tau prediction stratum</span></span>
<span><span class="co">##   mean     sd   2.5%    50%  97.5% </span></span>
<span><span class="co">## 0.3770 0.2170 0.0414 0.3460 0.8930 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## MAP Prior MCMC sample</span></span>
<span><span class="co">##   mean     sd   2.5%    50%  97.5% </span></span>
<span><span class="co">## 0.2580 0.0842 0.1120 0.2510 0.4590</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## a graphical representation of model checks is available</span></span>
<span><span class="va">pl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">map_mcmc</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## a number of plots are immediately defined</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pl</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "densityThetaStar"     "densityThetaStarLink" "forest_model"</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## forest plot with model estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pl</span><span class="op">$</span><span class="va">forest_model</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-3-1.png" width="622.08"></p>
<p>An often raised concern with a Bayesian analysis is the choice of the
prior. Hence sensitivity analyses may sometimes be necessary. They can
be quickly performed with the <strong><code>update</code></strong>
function. Suppose we want to evaluate a more optimistic scenario (with
less between-trial heterogeneity), expressed by a
<code>HalfNormal(0,1/2)</code> prior on <span class="math inline">\(\tau\)</span>. Then we can rerun the original
analysis, but with modified arguments of
<strong><code>gMAP</code></strong>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">36546</span><span class="op">)</span></span>
<span><span class="va">map_mcmc_sens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">map_mcmc</span>, tau.prior<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Assuming default prior location   for beta: 0</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">map_mcmc_sens</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Generalized Meta Analytic Predictive Prior Analysis</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:  gMAP(formula = cbind(r, n - r) ~ 1 | study, family = binomial, </span></span>
<span><span class="co">##     data = AS, tau.dist = "HalfNormal", tau.prior = 1/2, beta.prior = 2)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Exchangeability tau strata: 1 </span></span>
<span><span class="co">## Prediction tau stratum    : 1 </span></span>
<span><span class="co">## Maximal Rhat              : 1 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Between-trial heterogeneity of tau prediction stratum</span></span>
<span><span class="co">##   mean     sd   2.5%    50%  97.5% </span></span>
<span><span class="co">## 0.3320 0.1760 0.0351 0.3110 0.7270 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## MAP Prior MCMC sample</span></span>
<span><span class="co">##   mean     sd   2.5%    50%  97.5% </span></span>
<span><span class="co">## 0.2570 0.0795 0.1210 0.2480 0.4450</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="parametric-approximation">Parametric Approximation<a class="anchor" aria-label="anchor" href="#parametric-approximation"></a>
</h3>
<p>As a next step, the MAP prior, represented numerically using a large
MCMC simulation sample, is converted to a parametric representation with
the <strong><code>automixfit</code></strong> function. This function
fits a parametric mixture representation using expectation-maximization
(EM). The number of mixture components to best describe the MAP is
chosen automatically. Again, the <code>plot</code> function produces a
graphical diagnostic which allows the user to assess whether the
marginal mixture density (shown in black) matches well with the
histogram of the MAP MCMC sample.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/automixfit.html">automixfit</a></span><span class="op">(</span><span class="va">map_mcmc</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## EM for Beta Mixture Model</span></span>
<span><span class="co">## Log-Likelihood = 4523.865</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Univariate beta mixture</span></span>
<span><span class="co">## Mixture Components:</span></span>
<span><span class="co">##   comp1      comp2     </span></span>
<span><span class="co">## w  0.6167463  0.3832537</span></span>
<span><span class="co">## a 19.1916387  3.5278745</span></span>
<span><span class="co">## b 57.7779317  9.3735980</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span><span class="op">$</span><span class="va">mix</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-5-1.png" width="622.08"></p>
</div>
<div class="section level3">
<h3 id="effective-sample-size">Effective Sample Size<a class="anchor" aria-label="anchor" href="#effective-sample-size"></a>
</h3>
<p>The (usual) intended use of a (MAP) prior is to reduce the number of
control patients in the trial. The prior can be considered equivalent to
a number of experimental observations, which is called the effective
sample size (ESS) of the prior. It can be calculated in RBesT with the
<strong><code>ess</code></strong> function. It should be noted, however,
that the concept of ESS is somewhat elusive. In particular, the
definition of the ESS is not unique and multiple methods have therefore
been implemented in RBesT. The default method in RBesT is the elir
approach [5] which results in reasonable ESS estimates. The moment
matching approach leads to conservative (small) ESS estimates while the
Morita [3] method tends to estimates liberal (large) ESS estimates when
used with mixtures:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/ess.html">ess</a></span><span class="op">(</span><span class="va">map</span>, method<span class="op">=</span><span class="st">"elir"</span><span class="op">)</span><span class="op">)</span>   <span class="co">## default method</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 37</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/ess.html">ess</a></span><span class="op">(</span><span class="va">map</span>, method<span class="op">=</span><span class="st">"moment"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 26</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/ess.html">ess</a></span><span class="op">(</span><span class="va">map</span>, method<span class="op">=</span><span class="st">"morita"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 63</span></span></code></pre>
<p>The Morita approach uses the curvature of the prior at the mode and
has been found to be sensitive to a large number of mixture components.
From experience, a realistic ESS estimate can be obtained with the elir
method which is the only method which is predictively consistent, see
[5] for details.</p>
</div>
<div class="section level3">
<h3 id="robustification-of-the-map-prior">Robustification of the MAP Prior<a class="anchor" aria-label="anchor" href="#robustification-of-the-map-prior"></a>
</h3>
<p>Finally, we recommend to <strong><code>robustify</code></strong> [4]
the prior which protects against type-I error inflation in presence of
prior-data conflict, i.e. if the future trial data strongly deviate from
the historical control information.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## add a 20% non-informative mixture component</span></span>
<span><span class="va">map_robust</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/robustify.html">robustify</a></span><span class="op">(</span><span class="va">map</span>, weight<span class="op">=</span><span class="fl">0.2</span>, mean<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">map_robust</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Univariate beta mixture</span></span>
<span><span class="co">## Mixture Components:</span></span>
<span><span class="co">##   comp1     comp2     robust   </span></span>
<span><span class="co">## w  0.493397  0.306603  0.200000</span></span>
<span><span class="co">## a 19.191639  3.527874  1.000000</span></span>
<span><span class="co">## b 57.777932  9.373598  1.000000</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/ess.html">ess</a></span><span class="op">(</span><span class="va">map_robust</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 26</span></span></code></pre>
<p>Adding a robust mixture component does reduce the ESS of the MAP
prior to an extent which depends on the weight of the robust component.
Selecting higher robust mixture weights leads to greater discounting of
the informative MAP prior and vice versa. As a consequence the robust
weight controls the degree of influence of the MAP prior within the
final analysis. In some circumstances it can be helpful to graphically
illustrate the relationship of the prior ESS as a function of the robust
mixture component weight:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ess_weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>weight<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span>, by<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span>, ess<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">ess_weight</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ess_weight</span><span class="op">$</span><span class="va">ess</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ess.html">ess</a></span><span class="op">(</span><span class="fu"><a href="../reference/robustify.html">robustify</a></span><span class="op">(</span><span class="va">map</span>, <span class="va">ess_weight</span><span class="op">$</span><span class="va">weight</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">ess_weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">ess_weight</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>weight<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                               ess<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/ess.html">ess</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span>, <span class="fu"><a href="../reference/ess.html">ess</a></span><span class="op">(</span><span class="fu"><a href="../reference/mixbeta.html">mixbeta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html" class="external-link">qplot</a></span><span class="op">(</span><span class="va">weight</span>, <span class="va">ess</span>, data<span class="op">=</span><span class="va">ess_weight</span>, geom<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"point"</span>, <span class="st">"line"</span><span class="op">)</span>,</span>
<span>      main<span class="op">=</span><span class="st">"ESS of robust MAP for varying weight of robust component"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,  <span class="fl">1</span>, by<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">40</span>, by<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: `qplot()` was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
<p><img src="introduction_files/figure-html/unnamed-chunk-8-1.png" width="622.08"></p>
</div>
</div>
<div class="section level2">
<h2 id="design-evaluation">Design Evaluation<a class="anchor" aria-label="anchor" href="#design-evaluation"></a>
</h2>
<p>Now we have a prior which can be specified in the protocol. The
advantage of using historical information is the possible reduction of
the placebo patient group. The sample size of the control group is
supplemented by the historical information. The reduction in placebo
patients can be about as large as the ESS of the MAP prior.</p>
<p>In the following, we compare designs with different sample sizes and
priors for the control group. The comparisons are carried out by
evaluating standard Frequentist operating characteristics (type-I error,
power). The scenarios are not exhaustive, but rather specific ones to
demonstrate the use of RBesT for design evaluation.</p>
<div class="section level3">
<h3 id="operating-characteristics">Operating Characteristics<a class="anchor" aria-label="anchor" href="#operating-characteristics"></a>
</h3>
<p>We consider the 2-arm design of the actual Novartis trial in
ankylosing spondylitis [2]. This trial tested 6 patients on placebo as
control against 24 patients on an active experimental treatment. Success
was declared whenever the condition</p>
<p><span class="math display">\[\Pr(\theta_{active} - \theta_{control}
&gt; 0) &gt; 0.95\]</span></p>
<p>was met for the response rates <span class="math inline">\(\theta_{active}\)</span> and <span class="math inline">\(\theta_{control}\)</span>. A MAP prior was used
for the placebo response rate parameter. Here we evaluate a few design
options as an example.</p>
<p>The operating characteristics are setup in RBesT in a stepwise
manner:</p>
<ol style="list-style-type: decimal">
<li>Definition of priors for each arm.</li>
<li>Definition of the decision criterion using the
<strong><code>decision2S</code></strong> function.</li>
<li>Specification of design options with the
<strong><code>oc2S</code></strong> function. This includes the overall
decision function and per arm the prior and the sample size to use.</li>
<li>The object from step 3 is then used to calculate the operating
characteristics.</li>
</ol>
<p>Note that for a 1-sample situation the respective
<code>decision1S</code> and <code>oc1S</code> function are used
instead.</p>
<div class="section level4">
<h4 id="type-i-error">Type I Error<a class="anchor" aria-label="anchor" href="#type-i-error"></a>
</h4>
<p>The type I can be increased compared to the nominal <span class="math inline">\(\alpha\)</span> level in case of a conflict
between the trial data and the prior. Note, that in this example the MAP
prior has a 95% interval of about 0.1 to 0.5.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">theta</span>         <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.95</span>,by<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">uniform_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixbeta.html">mixbeta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">treat_prior</span>   <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixbeta.html">mixbeta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># prior for treatment used in trial</span></span>
<span><span class="va">lancet_prior</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixbeta.html">mixbeta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">11</span>,<span class="fl">32</span><span class="op">)</span><span class="op">)</span> <span class="co"># prior for control   used in trial</span></span>
<span><span class="va">decision</span>      <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decision2S.html">decision2S</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0</span>, lower.tail<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">design_uniform</span>   <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oc2S.html">oc2S</a></span><span class="op">(</span><span class="va">uniform_prior</span>, <span class="va">uniform_prior</span>, <span class="fl">24</span>,  <span class="fl">6</span>, <span class="va">decision</span><span class="op">)</span></span>
<span><span class="va">design_classic</span>   <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oc2S.html">oc2S</a></span><span class="op">(</span><span class="va">uniform_prior</span>, <span class="va">uniform_prior</span>, <span class="fl">24</span>, <span class="fl">24</span>, <span class="va">decision</span><span class="op">)</span></span>
<span><span class="va">design_nonrobust</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oc2S.html">oc2S</a></span><span class="op">(</span><span class="va">treat_prior</span>,   <span class="va">map</span>          , <span class="fl">24</span>,  <span class="fl">6</span>, <span class="va">decision</span><span class="op">)</span></span>
<span><span class="va">design_robust</span>    <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oc2S.html">oc2S</a></span><span class="op">(</span><span class="va">treat_prior</span>,   <span class="va">map_robust</span>   , <span class="fl">24</span>,  <span class="fl">6</span>, <span class="va">decision</span><span class="op">)</span></span>
<span></span>
<span><span class="va">typeI_uniform</span>   <span class="op">&lt;-</span> <span class="fu">design_uniform</span><span class="op">(</span>  <span class="va">theta</span>, <span class="va">theta</span><span class="op">)</span></span>
<span><span class="va">typeI_classic</span>   <span class="op">&lt;-</span> <span class="fu">design_classic</span><span class="op">(</span>  <span class="va">theta</span>, <span class="va">theta</span><span class="op">)</span></span>
<span><span class="va">typeI_nonrobust</span> <span class="op">&lt;-</span> <span class="fu">design_nonrobust</span><span class="op">(</span><span class="va">theta</span>, <span class="va">theta</span><span class="op">)</span></span>
<span><span class="va">typeI_robust</span>    <span class="op">&lt;-</span> <span class="fu">design_robust</span><span class="op">(</span>   <span class="va">theta</span>, <span class="va">theta</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ocI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>theta<span class="op">=</span><span class="va">theta</span>, typeI<span class="op">=</span><span class="va">typeI_robust</span>,    prior<span class="op">=</span><span class="st">"robust"</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>theta<span class="op">=</span><span class="va">theta</span>, typeI<span class="op">=</span><span class="va">typeI_nonrobust</span>, prior<span class="op">=</span><span class="st">"non-robust"</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>theta<span class="op">=</span><span class="va">theta</span>, typeI<span class="op">=</span><span class="va">typeI_uniform</span>,   prior<span class="op">=</span><span class="st">"uniform"</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>theta<span class="op">=</span><span class="va">theta</span>, typeI<span class="op">=</span><span class="va">typeI_classic</span>,   prior<span class="op">=</span><span class="st">"uniform 24:24"</span><span class="op">)</span></span>
<span>             <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html" class="external-link">qplot</a></span><span class="op">(</span><span class="va">theta</span>, <span class="va">typeI</span>, data<span class="op">=</span><span class="va">ocI</span>, colour<span class="op">=</span><span class="va">prior</span>, geom<span class="op">=</span><span class="st">"line"</span>, main<span class="op">=</span><span class="st">"Type I Error"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-9-1.png" width="622.08"></p>
<p>Note that observing response rates greater that 50% is highly
implausible based on the MAP analysis:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       mean         sd       2.5%      50.0%      97.5% </span></span>
<span><span class="co">## 0.25857963 0.08423297 0.10808237 0.25003652 0.47028444</span></span></code></pre>
<p>Hence, it is resonable to restrict the response rates <span class="math inline">\(\theta\)</span> for which we evaluate the type I
error to a a range of plausible values:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html" class="external-link">qplot</a></span><span class="op">(</span><span class="va">theta</span>, <span class="va">typeI</span>, data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ocI</span>, <span class="va">theta</span> <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">)</span>, colour<span class="op">=</span><span class="va">prior</span>, geom<span class="op">=</span><span class="st">"line"</span>,</span>
<span>      main<span class="op">=</span><span class="st">"Type I Error - response rate restricted to plausible range"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-11-1.png" width="622.08"></p>
</div>
<div class="section level4">
<h4 id="power">Power<a class="anchor" aria-label="anchor" href="#power"></a>
</h4>
<p>The power demonstrates the gain of using an informative prior;
i.e. 80% power is reached for smaller <span class="math inline">\(\delta\)</span> values in comparison to a design
with non-informative priors for both arms.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.7</span>,by<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="va">mean_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span><span class="op">[</span><span class="st">"mean"</span><span class="op">]</span></span>
<span><span class="va">theta_active</span>  <span class="op">&lt;-</span> <span class="va">mean_control</span> <span class="op">+</span>   <span class="va">delta</span></span>
<span><span class="va">theta_control</span> <span class="op">&lt;-</span> <span class="va">mean_control</span> <span class="op">+</span> <span class="fl">0</span><span class="op">*</span><span class="va">delta</span></span>
<span></span>
<span><span class="va">power_uniform</span>   <span class="op">&lt;-</span> <span class="fu">design_uniform</span><span class="op">(</span>  <span class="va">theta_active</span>, <span class="va">theta_control</span><span class="op">)</span></span>
<span><span class="va">power_classic</span>   <span class="op">&lt;-</span> <span class="fu">design_classic</span><span class="op">(</span>  <span class="va">theta_active</span>, <span class="va">theta_control</span><span class="op">)</span></span>
<span><span class="va">power_nonrobust</span> <span class="op">&lt;-</span> <span class="fu">design_nonrobust</span><span class="op">(</span><span class="va">theta_active</span>, <span class="va">theta_control</span><span class="op">)</span></span>
<span><span class="va">power_robust</span>    <span class="op">&lt;-</span> <span class="fu">design_robust</span><span class="op">(</span>   <span class="va">theta_active</span>, <span class="va">theta_control</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ocP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">theta_active</span>, <span class="va">theta_control</span>, delta<span class="op">=</span><span class="va">delta</span>, power<span class="op">=</span><span class="va">power_robust</span>,    prior<span class="op">=</span><span class="st">"robust"</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">theta_active</span>, <span class="va">theta_control</span>, delta<span class="op">=</span><span class="va">delta</span>, power<span class="op">=</span><span class="va">power_nonrobust</span>, prior<span class="op">=</span><span class="st">"non-robust"</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">theta_active</span>, <span class="va">theta_control</span>, delta<span class="op">=</span><span class="va">delta</span>, power<span class="op">=</span><span class="va">power_uniform</span>,   prior<span class="op">=</span><span class="st">"uniform"</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">theta_active</span>, <span class="va">theta_control</span>, delta<span class="op">=</span><span class="va">delta</span>, power<span class="op">=</span><span class="va">power_classic</span>,   prior<span class="op">=</span><span class="st">"uniform 24:24"</span><span class="op">)</span></span>
<span>             <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html" class="external-link">qplot</a></span><span class="op">(</span><span class="va">delta</span>, <span class="va">power</span>, data<span class="op">=</span><span class="va">ocP</span>, colour<span class="op">=</span><span class="va">prior</span>, geom<span class="op">=</span><span class="st">"line"</span>, main<span class="op">=</span><span class="st">"Power"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-12-1.png" width="622.08"></p>
<p>We see that with the MAP prior one reaches greater power at smaller
differences <span class="math inline">\(\delta\)</span> in the response
rate. For example, the <span class="math inline">\(\delta\)</span> for
which 80% power is reached can be found with:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">find_delta</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">design</span>, <span class="va">theta_control</span>, <span class="va">target_power</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/uniroot.html" class="external-link">uniroot</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">delta</span><span class="op">)</span> <span class="op">{</span> <span class="fu">design</span><span class="op">(</span><span class="va">theta_control</span> <span class="op">+</span> <span class="va">delta</span>, <span class="va">theta_control</span><span class="op">)</span> <span class="op">-</span> <span class="va">target_power</span> <span class="op">}</span>,</span>
<span>            interval<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">-</span><span class="va">theta_control</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">root</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">target_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>delta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">find_delta</span><span class="op">(</span><span class="va">design_nonrobust</span>, <span class="va">mean_control</span>, <span class="fl">0.8</span><span class="op">)</span>,</span>
<span>                                    <span class="fu">find_delta</span><span class="op">(</span><span class="va">design_classic</span>,   <span class="va">mean_control</span>, <span class="fl">0.8</span><span class="op">)</span>,</span>
<span>                                    <span class="fu">find_delta</span><span class="op">(</span><span class="va">design_robust</span>,    <span class="va">mean_control</span>, <span class="fl">0.8</span><span class="op">)</span>,                                    </span>
<span>                                    <span class="fu">find_delta</span><span class="op">(</span><span class="va">design_uniform</span>,   <span class="va">mean_control</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            prior<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"non-robust"</span>, <span class="st">"uniform 24:24"</span>, <span class="st">"robust"</span>, <span class="st">"uniform"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">target_effect</span>, digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">delta</th>
<th align="left">prior</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.298</td>
<td align="left">non-robust</td>
</tr>
<tr class="even">
<td align="right">0.341</td>
<td align="left">uniform 24:24</td>
</tr>
<tr class="odd">
<td align="right">0.368</td>
<td align="left">robust</td>
</tr>
<tr class="even">
<td align="right">0.529</td>
<td align="left">uniform</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="data-scenarios">Data Scenarios<a class="anchor" aria-label="anchor" href="#data-scenarios"></a>
</h4>
<p>An alternative approach to visualize the study design to
non-statisticians is by considering data scenarios. These show the
decisions based on potential trial outcomes. The information needed are
the critical values at which the decision criterion flips. In the
2-sample case this means to calculate the decision boundary, see the
<strong><code>decision2S_boundary</code></strong> help for more
information.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Critical values at which the decision flips are given conditional</span></span>
<span><span class="co">## on the outcome of the second read-out; as we like to have this as a</span></span>
<span><span class="co">## function of the treatment group outcome, we flip label 1 and 2</span></span>
<span><span class="va">decision_flipped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decision2S.html">decision2S</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0</span>, lower.tail<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">crit_uniform</span>     <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decision2S_boundary.html">decision2S_boundary</a></span><span class="op">(</span><span class="va">uniform_prior</span>, <span class="va">uniform_prior</span>, <span class="fl">6</span>, <span class="fl">24</span>, <span class="va">decision_flipped</span><span class="op">)</span></span>
<span><span class="va">crit_nonrobust</span>   <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decision2S_boundary.html">decision2S_boundary</a></span><span class="op">(</span><span class="va">map</span>          , <span class="va">treat_prior</span>  , <span class="fl">6</span>, <span class="fl">24</span>, <span class="va">decision_flipped</span><span class="op">)</span></span>
<span><span class="va">crit_robust</span>      <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decision2S_boundary.html">decision2S_boundary</a></span><span class="op">(</span><span class="va">map_robust</span>   , <span class="va">treat_prior</span>  , <span class="fl">6</span>, <span class="fl">24</span>, <span class="va">decision_flipped</span><span class="op">)</span></span>
<span><span class="va">treat_y2</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">:</span><span class="fl">24</span></span>
<span><span class="co">## Note that -1 is returned to indicated that the decision is never 1</span></span>
<span><span class="va">ocC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y2<span class="op">=</span><span class="va">treat_y2</span>, y1_crit<span class="op">=</span><span class="fu">crit_robust</span><span class="op">(</span><span class="va">treat_y2</span><span class="op">)</span>,    prior<span class="op">=</span><span class="st">"robust"</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y2<span class="op">=</span><span class="va">treat_y2</span>, y1_crit<span class="op">=</span><span class="fu">crit_nonrobust</span><span class="op">(</span><span class="va">treat_y2</span><span class="op">)</span>, prior<span class="op">=</span><span class="st">"non-robust"</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y2<span class="op">=</span><span class="va">treat_y2</span>, y1_crit<span class="op">=</span><span class="fu">crit_uniform</span><span class="op">(</span><span class="va">treat_y2</span><span class="op">)</span>,   prior<span class="op">=</span><span class="st">"uniform"</span><span class="op">)</span></span>
<span>             <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html" class="external-link">qplot</a></span><span class="op">(</span><span class="va">y2</span>, <span class="va">y1_crit</span>, data<span class="op">=</span><span class="va">ocC</span>, colour<span class="op">=</span><span class="va">prior</span>, geom<span class="op">=</span><span class="st">"step"</span>, main<span class="op">=</span><span class="st">"Critical values y1(y2)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-14-1.png" width="622.08"></p>
<p>The graph shows that the decision will always be negative if there
are less than 10 events in the treatment group. On the other hand, under
a non-robust prior and assuming 15 events in the treatment group, three
(or less) placebo events would be needed for success. To check this
result, we can directly evaluate the decision function:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## just positive</span></span>
<span><span class="fu">decision</span><span class="op">(</span><span class="fu"><a href="../reference/postmix.html">postmix</a></span><span class="op">(</span><span class="va">treat_prior</span>, n<span class="op">=</span><span class="fl">24</span>, r<span class="op">=</span><span class="fl">15</span><span class="op">)</span>, <span class="fu"><a href="../reference/postmix.html">postmix</a></span><span class="op">(</span><span class="va">map</span>, n<span class="op">=</span><span class="fl">6</span>, r<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## negative</span></span>
<span><span class="fu">decision</span><span class="op">(</span><span class="fu"><a href="../reference/postmix.html">postmix</a></span><span class="op">(</span><span class="va">treat_prior</span>, n<span class="op">=</span><span class="fl">24</span>, r<span class="op">=</span><span class="fl">14</span><span class="op">)</span>, <span class="fu"><a href="../reference/postmix.html">postmix</a></span><span class="op">(</span><span class="va">map</span>, n<span class="op">=</span><span class="fl">6</span>, r<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="trial-analysis">Trial Analysis<a class="anchor" aria-label="anchor" href="#trial-analysis"></a>
</h2>
<p>Once the trial has completed and data is collected, the final
analysis can be run with RBesT using the
<strong><code>postmix</code></strong> function. Calculations are
performed analytically as we are in the conjugate mixture setting.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_placebo</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">r_treat</span>   <span class="op">&lt;-</span> <span class="fl">14</span></span>
<span></span>
<span><span class="co">## first obtain posterior distributions...</span></span>
<span><span class="va">post_placebo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postmix.html">postmix</a></span><span class="op">(</span><span class="va">map_robust</span>,  r<span class="op">=</span><span class="va">r_placebo</span>, n<span class="op">=</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">post_treat</span>   <span class="op">&lt;-</span> <span class="fu"><a href="../reference/postmix.html">postmix</a></span><span class="op">(</span><span class="va">treat_prior</span>, r<span class="op">=</span><span class="va">r_treat</span>  , n<span class="op">=</span><span class="fl">24</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## ...then calculate probability that the difference is smaller than</span></span>
<span><span class="co">## zero</span></span>
<span><span class="va">prob_smaller</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixdiff.html">pmixdiff</a></span><span class="op">(</span><span class="va">post_treat</span>, <span class="va">post_placebo</span>,  <span class="fl">0</span>, lower.tail<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prob_smaller</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.9913233</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prob_smaller</span> <span class="op">&gt;</span> <span class="fl">0.95</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## alternativley we can use the decision object</span></span>
<span><span class="fu">decision</span><span class="op">(</span><span class="va">post_treat</span>, <span class="va">post_placebo</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span></code></pre>
<div class="section level4">
<h4 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h4>
<p>[1] Neuenschwander B. et al., <em>Clin Trials</em>. 2010;
7(1):5-18<br>
[2] Baeten D. et al., <em>The Lancet</em>, 2013, (382), 9906, p
1705<br>
[3] Morita S. et al., <em>Biometrics</em> 2008;64(2):595-602<br>
[4] Schmidli H. et al., <em>Biometrics</em> 2014;70(4):1023-1032<br>
[5] Neuenschwander B. et al., <em>Biometrics</em> 2020;76(2):578-587</p>
</div>
<div class="section level4">
<h4 id="r-session-info">R Session Info<a class="anchor" aria-label="anchor" href="#r-session-info"></a>
</h4>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.3.1 (2023-06-16)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.2 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] ggplot2_3.4.2 knitr_1.43    RBesT_1.7-0  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] tensorA_0.36.2       gtable_0.3.3         xfun_0.39           </span></span>
<span><span class="co">##  [4] bslib_0.5.0          processx_3.8.2       inline_0.3.19       </span></span>
<span><span class="co">##  [7] callr_3.7.3          vctrs_0.6.3          tools_4.3.1         </span></span>
<span><span class="co">## [10] ps_1.7.5             generics_0.1.3       stats4_4.3.1        </span></span>
<span><span class="co">## [13] parallel_4.3.1       tibble_3.2.1         fansi_1.0.4         </span></span>
<span><span class="co">## [16] highr_0.10           pkgconfig_2.0.3      checkmate_2.2.0     </span></span>
<span><span class="co">## [19] desc_1.4.2           distributional_0.3.2 RcppParallel_5.1.7  </span></span>
<span><span class="co">## [22] assertthat_0.2.1     lifecycle_1.0.3      farver_2.1.1        </span></span>
<span><span class="co">## [25] compiler_4.3.1       stringr_1.5.0        textshaping_0.3.6   </span></span>
<span><span class="co">## [28] munsell_0.5.0        codetools_0.2-19     htmltools_0.5.5     </span></span>
<span><span class="co">## [31] sass_0.4.7           bayesplot_1.10.0     yaml_2.3.7          </span></span>
<span><span class="co">## [34] Formula_1.2-5        pillar_1.9.0         pkgdown_2.0.7       </span></span>
<span><span class="co">## [37] crayon_1.5.2         jquerylib_0.1.4      cachem_1.0.8        </span></span>
<span><span class="co">## [40] StanHeaders_2.26.27  abind_1.4-5          posterior_1.4.1     </span></span>
<span><span class="co">## [43] rstan_2.21.8         tidyselect_1.2.0     digest_0.6.33       </span></span>
<span><span class="co">## [46] mvtnorm_1.2-2        stringi_1.7.12       reshape2_1.4.4      </span></span>
<span><span class="co">## [49] dplyr_1.1.2          purrr_1.0.1          labeling_0.4.2      </span></span>
<span><span class="co">## [52] rprojroot_2.0.3      fastmap_1.1.1        grid_4.3.1          </span></span>
<span><span class="co">## [55] colorspace_2.1-0     cli_3.6.1            magrittr_2.0.3      </span></span>
<span><span class="co">## [58] loo_2.6.0            pkgbuild_1.4.2       utf8_1.2.3          </span></span>
<span><span class="co">## [61] withr_2.5.0          prettyunits_1.1.1    scales_1.2.1        </span></span>
<span><span class="co">## [64] backports_1.4.1      rmarkdown_2.23       matrixStats_1.0.0   </span></span>
<span><span class="co">## [67] gridExtra_2.3        ragg_1.2.5           memoise_2.0.1       </span></span>
<span><span class="co">## [70] evaluate_0.21        rstantools_2.3.1.1   rlang_1.1.1         </span></span>
<span><span class="co">## [73] Rcpp_1.0.11          glue_1.6.2           jsonlite_1.8.7      </span></span>
<span><span class="co">## [76] plyr_1.8.8           R6_2.5.1             systemfonts_1.0.4   </span></span>
<span><span class="co">## [79] fs_1.6.2</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sebastian Weber.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
