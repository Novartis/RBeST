<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="RBesT">
<title>Meta-Analytic-Predictive Priors for Variances • RBesT</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Meta-Analytic-Predictive Priors for Variances">
<meta property="og:description" content="RBesT">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">RBesT</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7-2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/PoS_codata.html">Probability of Success with Co-Data</a>
    <a class="dropdown-item" href="../articles/PoS_interim.html">Probability of Success at an Interim Analysis</a>
    <a class="dropdown-item" href="../articles/customizing_plots.html">Customizing RBesT plots</a>
    <a class="dropdown-item" href="../articles/introduction.html">Getting started with RBesT (binary)</a>
    <a class="dropdown-item" href="../articles/introduction_normal.html">RBesT for a Normal Endpoint</a>
    <a class="dropdown-item" href="../articles/variances_MAP.html">Meta-Analytic-Predictive Priors for Variances</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Novartis/RBesT/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Meta-Analytic-Predictive Priors for Variances</h1>
                        <h4 data-toc-skip class="author">Sebastian
Weber</h4>
            
            <h4 data-toc-skip class="date">2023-08-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Novartis/RBesT/blob/HEAD/vignettes/variances_MAP.Rmd" class="external-link"><code>vignettes/variances_MAP.Rmd</code></a></small>
      <div class="d-none name"><code>variances_MAP.Rmd</code></div>
    </div>

    
    
<p>Applying the meta-analytic-predictive (MAP) prior approach to
historical data on variances has been suggested in [1]. The utility is a
better informed planning of future trials which use a normal endpoint.
For these reliable information on the sampling standard deviation is
crucial for planning the trial.</p>
<p>Under a normal sampling distribution the (standard) unbiased variance
estimator for a sample <span class="math inline">\(y_j\)</span> of size
<span class="math inline">\(n_j\)</span> is</p>
<p><span class="math display">\[ s^2_j = \frac{1}{n_j-1}
\sum_{i=1}^{n_j} (y_{j,i} - \bar{y}_j)^2, \]</span></p>
<p>which follows a <span class="math inline">\(\chi^2_\nu\)</span>
distribution with <span class="math inline">\(\nu_j = n_j-1\)</span>
degrees of freedom. The <span class="math inline">\(\chi^2_\nu\)</span>
can be rewritten as a <span class="math inline">\(\Gamma\)</span>
distribution</p>
<p><span class="math display">\[ s^2_j|\nu_j,\sigma_j \sim
\Gamma(\nu_j/2, \nu_j/(2\,\sigma^2_j)) \]</span> <span class="math display">\[ \Leftrightarrow s^2_j \, \nu_j /2
|\nu_j,\sigma_j \sim \Gamma(\nu_j/2, 1/\sigma^2_j), \]</span></p>
<p>where <span class="math inline">\(\sigma_j\)</span> is the (unknown)
sampling standard deviation for the data <span class="math inline">\(y_j\)</span>.</p>
<p>While this is not directly supported in <code>RBesT</code>, a normal
approximation of the <span class="math inline">\(\log\)</span>
transformed <span class="math inline">\(\Gamma\)</span> variate can be
applied. When <span class="math inline">\(\log\)</span> transforming a
<span class="math inline">\(\Gamma(\alpha,\beta)\)</span> variate it’s
moment and variance can analytically be shown to be (see [2], for
example)</p>
<p><span class="math display">\[ E[\log(X)] = \psi(\alpha) -
\log(\beta)\]</span> <span class="math display">\[ Var[\log(X)] =
\psi^{(1)}(\alpha).\]</span></p>
<p>Here, <span class="math inline">\(\psi(x)\)</span> is the digamma
function and <span class="math inline">\(\psi^{(1)}(x)\)</span> is the
polygamma function of order 1 (second derivative of the <span class="math inline">\(\log\)</span> of the <span class="math inline">\(\Gamma\)</span> function).</p>
<p>Thus, by approximating the <span class="math inline">\(\log\)</span>
transformed <span class="math inline">\(\Gamma\)</span> distribution
with a normal approximation, we can apply <code>gMAP</code> as if we
were using a normal endpoint. Specifically, we apply the transform <span class="math inline">\(Y_j=\log(s^2_j \, \nu_j /2) -
\psi(\nu_j/2)\)</span> such that the meta-analytic model directly
considers <span class="math inline">\(\log \sigma_j\)</span> as random
variate. The normal approximation becomes more accurate, the larger the
degrees of freedom are. The section at the bottom of this vignette
discusses this approximation accuracy and concludes that independent of
the true <span class="math inline">\(\sigma\)</span> value for 10
observations the approxmation is useful and a very good one for more
than 20 observations.</p>
<p>In the following we reanalyze the main example of reference [1] which
is shown in table 2:</p>
<table class="table">
<thead><tr class="header">
<th align="right">study</th>
<th align="right">sd</th>
<th align="right">df</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">12.11</td>
<td align="right">597</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">10.97</td>
<td align="right">60</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">10.94</td>
<td align="right">548</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">9.41</td>
<td align="right">307</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">10.97</td>
<td align="right">906</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">10.95</td>
<td align="right">903</td>
</tr>
</tbody>
</table>
<p>Using the above equations (and using plug-in estimates for <span class="math inline">\(\sigma_j\)</span>) this translates into an
approximate normal distribution for the <span class="math inline">\(\log\)</span> variance as:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">hdata</span>,</span>
<span>                alpha<span class="op">=</span><span class="va">df</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>                beta<span class="op">=</span><span class="va">alpha</span><span class="op">/</span><span class="va">sd</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>                logvar_mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">sd</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">alpha</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">digamma</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>,</span>
<span>                logvar_var<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">psigamma</a></span><span class="op">(</span><span class="va">alpha</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">study</th>
<th align="right">sd</th>
<th align="right">df</th>
<th align="right">alpha</th>
<th align="right">beta</th>
<th align="right">logvar_mean</th>
<th align="right">logvar_var</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">12.11</td>
<td align="right">597</td>
<td align="right">298.5</td>
<td align="right">2.0354</td>
<td align="right">4.9897</td>
<td align="right">0.0034</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">10.97</td>
<td align="right">60</td>
<td align="right">30.0</td>
<td align="right">0.2493</td>
<td align="right">4.8071</td>
<td align="right">0.0339</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">10.94</td>
<td align="right">548</td>
<td align="right">274.0</td>
<td align="right">2.2894</td>
<td align="right">4.7867</td>
<td align="right">0.0037</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">9.41</td>
<td align="right">307</td>
<td align="right">153.5</td>
<td align="right">1.7335</td>
<td align="right">4.4868</td>
<td align="right">0.0065</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">10.97</td>
<td align="right">906</td>
<td align="right">453.0</td>
<td align="right">3.7643</td>
<td align="right">4.7914</td>
<td align="right">0.0022</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">10.95</td>
<td align="right">903</td>
<td align="right">451.5</td>
<td align="right">3.7656</td>
<td align="right">4.7878</td>
<td align="right">0.0022</td>
</tr>
</tbody>
</table>
<p>In order to run the MAP analysis a prior for the heterogeniety
parameter <span class="math inline">\(\tau\)</span> and the intercept
<span class="math inline">\(\beta\)</span> is needed. In reference [3]
it is demonstrated that the (approximate) sampling standard deviation of
the <span class="math inline">\(\log\)</span> variance is <span class="math inline">\(\sqrt{2}\)</span>. Thus, a
<code>HalfNormal(0,sqrt(2)/2)</code> is a very conservative choice for
the between-study heterogeniety parameter. A less conservative choice is
<code>HalfNormal(0,sqrt(2)/4)</code>, which gives very similar results
in this case. For the intercept <span class="math inline">\(\beta\)</span> a very wide prior is used with a
standard deviation of <span class="math inline">\(100\)</span> which is
in line with reference [1]:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_mc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gMAP.html">gMAP</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">logvar_mean</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">logvar_var</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">study</span>, data<span class="op">=</span><span class="va">hdata</span>,</span>
<span>               tau.dist<span class="op">=</span><span class="st">"HalfNormal"</span>, tau.prior<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>               beta.prior<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">4.8</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">map_mc</span></span></code></pre></div>
<pre><code><span><span class="co">## Generalized Meta Analytic Predictive Prior Analysis</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:  gMAP(formula = cbind(logvar_mean, sqrt(logvar_var)) ~ 1 | study, </span></span>
<span><span class="co">##     data = hdata, tau.dist = "HalfNormal", tau.prior = sqrt(2)/2, </span></span>
<span><span class="co">##     beta.prior = cbind(4.8, 100))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Exchangeability tau strata: 1 </span></span>
<span><span class="co">## Prediction tau stratum    : 1 </span></span>
<span><span class="co">## Maximal Rhat              : 1 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Between-trial heterogeneity of tau prediction stratum</span></span>
<span><span class="co">##   mean     sd   2.5%    50%  97.5% </span></span>
<span><span class="co">## 0.2050 0.1040 0.0781 0.1830 0.4720 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## MAP Prior MCMC sample</span></span>
<span><span class="co">##  mean    sd  2.5%   50% 97.5% </span></span>
<span><span class="co">## 4.780 0.256 4.240 4.780 5.270</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">map_mc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Heterogeneity parameter tau per stratum:</span></span>
<span><span class="co">##         mean    sd   2.5%   50% 97.5%</span></span>
<span><span class="co">## tau[1] 0.205 0.104 0.0781 0.183 0.472</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Regression coefficients:</span></span>
<span><span class="co">##             mean    sd 2.5%  50% 97.5%</span></span>
<span><span class="co">## (Intercept) 4.78 0.101 4.57 4.78  4.97</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Mean estimate MCMC sample:</span></span>
<span><span class="co">##            mean    sd 2.5%  50% 97.5%</span></span>
<span><span class="co">## theta_resp 4.78 0.101 4.57 4.78  4.97</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## MAP Prior MCMC sample:</span></span>
<span><span class="co">##                 mean    sd 2.5%  50% 97.5%</span></span>
<span><span class="co">## theta_resp_pred 4.78 0.256 4.24 4.78  5.27</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">map_mc</span><span class="op">)</span><span class="op">$</span><span class="va">forest_model</span></span></code></pre></div>
<p><img src="variances_MAP_files/figure-html/unnamed-chunk-7-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>In reference [1] the correct <span class="math inline">\(\Gamma\)</span> likelihood is used in contrast to
the approximate normal approach above. Still, the results match very
close, even for the outer quantiles.</p>
<div class="section level2">
<h2 id="map-prior-for-the-sampling-standard-deviation">MAP prior for the sampling standard deviation<a class="anchor" aria-label="anchor" href="#map-prior-for-the-sampling-standard-deviation"></a>
</h2>
<p>While the MAP analysis is performed for the <span class="math inline">\(\log\)</span> variance, we are actually interested
in the MAP of the respective sampling standard deviation. Since the
sampling standard deviation is a strictly positive quantity it is
suitable to approximate the MCMC posterior of the MAP prior using a
mixture of <span class="math inline">\(\Gamma\)</span> variates, which
can be done using <code>RBesT</code> as:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_mc_post</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">map_mc</span><span class="op">)</span></span>
<span><span class="va">sd_trans</span> <span class="op">&lt;-</span> <span class="fu">compose</span><span class="op">(</span><span class="va">sqrt</span>, <span class="va">exp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-intervals.html" class="external-link">mcmc_intervals</a></span><span class="op">(</span><span class="va">map_mc_post</span>, regex_pars<span class="op">=</span><span class="st">"theta"</span>, transformation<span class="op">=</span><span class="va">sd_trans</span><span class="op">)</span></span></code></pre></div>
<p><img src="variances_MAP_files/figure-html/unnamed-chunk-8-1.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_sigma_mc</span> <span class="op">&lt;-</span> <span class="fu">sd_trans</span><span class="op">(</span><span class="va">map_mc_post</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"theta_pred"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">map_sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/automixfit.html">automixfit</a></span><span class="op">(</span><span class="va">map_sigma_mc</span>, type<span class="op">=</span><span class="st">"gamma"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">map_sigma</span><span class="op">)</span><span class="op">$</span><span class="va">mix</span></span></code></pre></div>
<p><img src="variances_MAP_files/figure-html/unnamed-chunk-8-2.png" width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 95% interval MAP for the sampling standard deviation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">map_sigma</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      mean        sd      2.5%     50.0%     97.5% </span></span>
<span><span class="co">## 10.980236  1.401089  8.283373 10.921528 14.063679</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="normal-approximation-of-a-loggamma-variate">Normal approximation of a <span class="math inline">\(\log\Gamma\)</span> variate<a class="anchor" aria-label="anchor" href="#normal-approximation-of-a-loggamma-variate"></a>
</h2>
<p>For a <span class="math inline">\(\Gamma(y|\alpha, \beta)\)</span>
variate <span class="math inline">\(y\)</span>, which is <span class="math inline">\(\log\)</span> transformed, <span class="math inline">\(z = \log(y)\)</span>, we have by the law of
transformations for univariate densities:</p>
<p><span class="math display">\[ y|\alpha,\beta \sim
\Gamma(\alpha,\beta) \]</span> <span class="math display">\[ p(z) = p(y)
\, y = p(\exp(z)) \, \exp(z) \]</span> <span class="math display">\[
z|\alpha,\beta \sim \log\Gamma(\alpha,\beta)\]</span> <span class="math display">\[\Leftrightarrow \exp(z)|\alpha,\beta \sim
\Gamma(\alpha,\beta) \, \exp(z) \]</span></p>
<p>The first and second moment of <span class="math inline">\(z\)</span>
is then <span class="math display">\[ E[z] = \psi(\alpha) -
\log(\beta)\]</span> <span class="math display">\[ Var[z] =
\psi^{(1)}(\alpha).\]</span></p>
<p>A short simulation demonstrates the above results:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gamma_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixgamma.html">mixgamma</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">18</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## logGamma density</span></span>
<span><span class="va">dlogGamma</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span>, <span class="va">a</span>, <span class="va">b</span>, <span class="va">log</span><span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">log</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">dgamma</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">*</span> <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">dgamma</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">a</span>, <span class="va">b</span>, log<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="va">z</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">gamma_dist</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">gamma_dist</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">digamma</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></span>
<span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html" class="external-link">psigamma</a></span><span class="op">(</span><span class="va">a</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## compare simulated histogram of log transformed Gamma variates to</span></span>
<span><span class="co">## analytic density and approximate normal</span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mix.html">rmix</a></span><span class="op">(</span><span class="va">gamma_dist</span>, <span class="fl">1E5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-distributions.html" class="external-link">mcmc_hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>logGamma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span><span class="op">)</span>, freq<span class="op">=</span><span class="cn">FALSE</span>, binwidth<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://mc-stan.org/bayesplot/reference/bayesplot-helpers.html" class="external-link">overlay_function</a></span><span class="op">(</span>fun<span class="op">=</span><span class="va">dlogGamma</span>, args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a<span class="op">=</span><span class="va">a</span>,b<span class="op">=</span><span class="va">b</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linetype<span class="op">=</span><span class="st">"LogGamma"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://mc-stan.org/bayesplot/reference/bayesplot-helpers.html" class="external-link">overlay_function</a></span><span class="op">(</span>fun<span class="op">=</span><span class="va">dnorm</span>, args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean<span class="op">=</span><span class="va">m</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linetype<span class="op">=</span><span class="st">"NormalApprox"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="variances_MAP_files/figure-html/unnamed-chunk-9-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>We see that for <span class="math inline">\(\nu=9\)</span> only, the
approximation with a normal density is reasonable. However, by comparing
as a function of <span class="math inline">\(\nu\)</span> the <span class="math inline">\(2.5\)</span>%, <span class="math inline">\(50\)</span>% and <span class="math inline">\(97.5\)</span>% quantiles of the correct
distribution with the respective approximate distribution we can assess
the adequatness of the approximation. The respective R code is
accessible via the vignette overview page while here the graphical
result is presented for two different <span class="math inline">\(\sigma\)</span> values:</p>
<p><img src="variances_MAP_files/figure-html/unnamed-chunk-10-1.png" width="100%" style="display: block; margin: auto;"><img src="variances_MAP_files/figure-html/unnamed-chunk-10-2.png" width="100%" style="display: block; margin: auto;"><img src="variances_MAP_files/figure-html/unnamed-chunk-10-3.png" width="100%" style="display: block; margin: auto;"><img src="variances_MAP_files/figure-html/unnamed-chunk-10-4.png" width="100%" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h3>
<p>Many thanks to Ping Chen and Simon Wandel for pointing out an issue
with the transformation as used earlier in this vignette.</p>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<p>[1] Schmidli, H., et. al, Comp. Stat. and Data Analysis, 2017,
113:100-110<br>
[2] <a href="https://en.wikipedia.org/wiki/Gamma_distribution#Logarithmic_expectation_and_variance" class="external-link uri">https://en.wikipedia.org/wiki/Gamma_distribution#Logarithmic_expectation_and_variance</a><br>
[3] Gelman A, et. al, Bayesian Data Analysis. Third edit., 2014.,
Chapter 4, p. 84</p>
</div>
<div class="section level3">
<h3 id="r-session-info">R Session Info<a class="anchor" aria-label="anchor" href="#r-session-info"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.3.1 (2023-06-16)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.3 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] bayesplot_1.10.0 purrr_1.0.2      dplyr_1.1.2      ggplot2_3.4.3   </span></span>
<span><span class="co">## [5] knitr_1.43       RBesT_1.7-2     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] tensorA_0.36.2       gtable_0.3.3         xfun_0.40           </span></span>
<span><span class="co">##  [4] bslib_0.5.1          processx_3.8.2       inline_0.3.19       </span></span>
<span><span class="co">##  [7] callr_3.7.3          vctrs_0.6.3          tools_4.3.1         </span></span>
<span><span class="co">## [10] ps_1.7.5             generics_0.1.3       stats4_4.3.1        </span></span>
<span><span class="co">## [13] parallel_4.3.1       tibble_3.2.1         fansi_1.0.4         </span></span>
<span><span class="co">## [16] highr_0.10           pkgconfig_2.0.3      checkmate_2.2.0     </span></span>
<span><span class="co">## [19] desc_1.4.2           distributional_0.3.2 RcppParallel_5.1.7  </span></span>
<span><span class="co">## [22] assertthat_0.2.1     lifecycle_1.0.3      farver_2.1.1        </span></span>
<span><span class="co">## [25] compiler_4.3.1       stringr_1.5.0        textshaping_0.3.6   </span></span>
<span><span class="co">## [28] munsell_0.5.0        codetools_0.2-19     htmltools_0.5.6     </span></span>
<span><span class="co">## [31] sass_0.4.7           yaml_2.3.7           Formula_1.2-5       </span></span>
<span><span class="co">## [34] pillar_1.9.0         pkgdown_2.0.7        crayon_1.5.2        </span></span>
<span><span class="co">## [37] jquerylib_0.1.4      cachem_1.0.8         StanHeaders_2.26.27 </span></span>
<span><span class="co">## [40] abind_1.4-5          posterior_1.4.1      rstan_2.21.8        </span></span>
<span><span class="co">## [43] tidyselect_1.2.0     digest_0.6.33        mvtnorm_1.2-2       </span></span>
<span><span class="co">## [46] stringi_1.7.12       reshape2_1.4.4       labeling_0.4.2      </span></span>
<span><span class="co">## [49] rprojroot_2.0.3      fastmap_1.1.1        grid_4.3.1          </span></span>
<span><span class="co">## [52] colorspace_2.1-0     cli_3.6.1            magrittr_2.0.3      </span></span>
<span><span class="co">## [55] loo_2.6.0            pkgbuild_1.4.2       utf8_1.2.3          </span></span>
<span><span class="co">## [58] withr_2.5.0          prettyunits_1.1.1    scales_1.2.1        </span></span>
<span><span class="co">## [61] backports_1.4.1      rmarkdown_2.24       matrixStats_1.0.0   </span></span>
<span><span class="co">## [64] gridExtra_2.3        ragg_1.2.5           memoise_2.0.1       </span></span>
<span><span class="co">## [67] evaluate_0.21        rstantools_2.3.1.1   rlang_1.1.1         </span></span>
<span><span class="co">## [70] Rcpp_1.0.11          glue_1.6.2           jsonlite_1.8.7      </span></span>
<span><span class="co">## [73] plyr_1.8.8           R6_2.5.1             systemfonts_1.0.4   </span></span>
<span><span class="co">## [76] fs_1.6.3</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sebastian Weber.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
