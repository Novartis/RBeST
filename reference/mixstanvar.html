<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Adapter function converting mixture distributions for
    use with brm models via the
    stanvar facility."><title>Mixture distributions as brms priors — mixstanvar • RBesT</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mixture distributions as brms priors — mixstanvar"><meta property="og:description" content="Adapter function converting mixture distributions for
    use with brm models via the
    stanvar facility."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">RBesT</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7-3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/PoS_codata.html">Probability of Success with Co-Data</a>
    <a class="dropdown-item" href="../articles/PoS_interim.html">Probability of Success at an Interim Analysis</a>
    <a class="dropdown-item" href="../articles/customizing_plots.html">Customizing RBesT plots</a>
    <a class="dropdown-item" href="../articles/introduction_normal.html">RBesT for a Normal Endpoint</a>
    <a class="dropdown-item" href="../articles/variances_MAP.html">Meta-Analytic-Predictive Priors for Variances</a>
    <a class="dropdown-item" href="../articles/introduction.html">Getting started with RBesT (binary)</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Novartis/RBesT/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Mixture distributions as <code>brms</code> priors</h1>
      <small class="dont-index">Source: <a href="https://github.com/Novartis/RBesT/blob/HEAD/R/mixstanvar.R" class="external-link"><code>R/mixstanvar.R</code></a></small>
      <div class="d-none name"><code>mixstanvar.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Adapter function converting mixture distributions for
    use with <code><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></code> models via the
    <code><a href="https://paul-buerkner.github.io/brms/reference/stanvar.html" class="external-link">stanvar</a></code> facility.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mixstanvar</span><span class="op">(</span><span class="va">...</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>...</dt>
<dd><p>List of mixtures to convert.</p></dd>


<dt>verbose</dt>
<dd><p>Enables printing of the mixture priors when chains
start to sample. Defaults to <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p><code>stanvars</code> object to be used as argument to the</p>
<p></p>
<p><code>stanvars</code> argument of a <code><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></code> model.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>To declare mixture priors in a <code><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></code>
    model requires two steps: First, the mixture densities need to
    be converted by the adapter function <code>mixstanvar</code> into a
    <code>stanvars</code> object which is passed to the <code>stanvars</code>
    argument of the <code><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></code> function. Doing so
    extends the Stan code and data generated by
    <code><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></code> such that the mixture densities can be
    used as priors within the <code><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></code> model. The
    second step is to assign parameters of the
    <code><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></code> model to the mixture density as prior
    using the <code><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></code> command of <code>brms</code>.</p>
<p>The adapter function translates the mixture distributions as
 defined in <code>R</code> to the respective mixture distribution in
 Stan. Within Stan the mixture distributions are named in
 accordance to the <code>R</code> functions used to create the respective
 mixture distributions. That is, a mixture density of normals
 created by <code><a href="mixnorm.html">mixnorm</a></code> is referred to as
 <code>mixnorm_lpdf</code> in Stan such that one can refer to the density
 as <code>mixnorm</code> within the <code><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></code>
 functions (the suffix <code>_lpdf</code> is automatically added by
 <code><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></code>). The arguments to these mixture
 distributions depend on the specific distribution type as follows:</p>
<table class="table table"><tr><td>Density</td><td>Arguments</td></tr><tr><td><code>mixbeta(w, a, b)</code></td><td><code>w</code> weights, <code>a</code> shapes, <code>b</code> shapes</td></tr><tr><td><code>mixgamma(w, a, b)</code></td><td><code>w</code> weights, <code>a</code> shapes, <code>b</code> inverse scales</td></tr><tr><td><code>mixnorm(w, m, s)</code></td><td><code>w</code> weights, <code>m</code> means, <code>s</code> standard deviations</td></tr><tr><td><code>mixmvnorm(w, m, sigma_L)</code></td><td><code>w</code> weights, <code>m</code> means, <code>sigma_L</code> cholesky factors of covariances</td></tr></table><p>These arguments to the mixture densities refer to the different
density parameters and are automatically extracted from the
mixtures when converted. Important here are the argument names as
these must be used to declare the mixture prior. For each mixture
to convert as part of the <code>...</code>  argument to <code>mixstanvar</code>
a label is determined using the name given in the list. In case no
name is given, then the name of the <code>R</code> object itself is
used. To declare a prior for a parameter the mixture distribution
must be used with it's arguments following the convention
<code>label_argument</code>. Please refer to the examples section for an
illustration.</p>
<p><strong>Note:</strong> Models created by <code><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></code> do use by
default a data-dependent centering of covariates leading to a shift
of the overall intercept. This is commonly not desirable in
applications of this functionality. It is therefore strongly
recommended to pass the option <code>center=FALSE</code> as argument to
the <code>brms</code> formula created with the <code><a href="https://paul-buerkner.github.io/brms/reference/brmsformula.html" class="external-link">bf</a></code>
function as demonstrated with the example below.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># The mixstanvar adapter requires the optional packages brms and glue</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/paul-buerkner/brms" class="external-link">"brms"</a></span><span class="op">)</span>, <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/tidyverse/glue" class="external-link">"glue"</a></span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Assume we prefer a logistic regression MCMC analysis rather than a</span></span></span>
<span class="r-in"><span><span class="co"># beta-binomial analysis for the responder endpoint of the ankylosing</span></span></span>
<span class="r-in"><span><span class="co"># spondylitis (AS) example. Reasons to prefer a regression analysis is</span></span></span>
<span class="r-in"><span><span class="co"># to allow for baseline covariate adjustments, for example.</span></span></span>
<span class="r-in"><span><span class="va">map_AS_beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="mixbeta.html">mixbeta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.62</span>, <span class="fl">19.2</span>, <span class="fl">57.8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.38</span>, <span class="fl">3.5</span>, <span class="fl">9.4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># First we need to convert the beta mixture to a respective mixture on</span></span></span>
<span class="r-in"><span><span class="co"># the log odds scale and approximate it with a normal mixture density.</span></span></span>
<span class="r-in"><span><span class="va">map_AS_samp</span> <span class="op">&lt;-</span> <span class="fu"><a href="mix.html">rmix</a></span><span class="op">(</span><span class="va">map_AS_beta</span>, <span class="fl">1E4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">map_AS</span> <span class="op">&lt;-</span> <span class="fu"><a href="mixfit.html">mixfit</a></span><span class="op">(</span><span class="fu"><a href="lodds.html">logit</a></span><span class="op">(</span><span class="va">map_AS_samp</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"norm"</span>, Nc<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Trial results for placebo and secukinumab.</span></span></span>
<span class="r-in"><span><span class="va">trial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">24</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    r<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">15</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    arm<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"placebo"</span>, <span class="st">"secukinumab"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define brms model such that the overall intercept corresponds to the</span></span></span>
<span class="r-in"><span><span class="co"># placebo response rate on the logit scale. NOTE: The use of</span></span></span>
<span class="r-in"><span><span class="co"># center=FALSE is required here as detailed in the note above.</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brmsformula.html" class="external-link">bf</a></span><span class="op">(</span><span class="va">r</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">arm</span>, family<span class="op">=</span><span class="va">binomial</span>, center<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># to obtain detailed information on the declared model parameters use</span></span></span>
<span class="r-in"><span><span class="co"># get_prior(model, data=trial)</span></span></span>
<span class="r-in"><span><span class="co"># declare model prior with reference to mixture normal map prior...</span></span></span>
<span class="r-in"><span><span class="va">model_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">prior</a></span><span class="op">(</span><span class="fu"><a href="mixnorm.html">mixnorm</a></span><span class="op">(</span><span class="va">map_w</span>, <span class="va">map_m</span>, <span class="va">map_s</span><span class="op">)</span>, coef<span class="op">=</span><span class="va">Intercept</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, class<span class="op">=</span><span class="va">b</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ... which must be made available to brms using the mixstanvar adapter.</span></span></span>
<span class="r-in"><span><span class="co"># Note that the map_AS prior is labeled "map" as referred to in the</span></span></span>
<span class="r-in"><span><span class="co"># previous prior declaration.</span></span></span>
<span class="r-in"><span><span class="va">analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/brm.html" class="external-link">brm</a></span><span class="op">(</span><span class="va">model</span>, data<span class="op">=</span><span class="va">trial</span>, prior<span class="op">=</span><span class="va">model_prior</span>,</span></span>
<span class="r-in"><span>                stanvars<span class="op">=</span><span class="fu">mixstanvar</span><span class="op">(</span>map<span class="op">=</span><span class="va">map_AS</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                seed<span class="op">=</span><span class="fl">365634</span>, refresh<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Let's compare the logistic regression estimate for the probability</span></span></span>
<span class="r-in"><span><span class="co"># of a positive treatment effect (secukinumab response rate exceeding</span></span></span>
<span class="r-in"><span><span class="co"># the response rate of placebo) to the direct beta-binomial analysis:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/hypothesis.brmsfit.html" class="external-link">hypothesis</a></span><span class="op">(</span><span class="va">analysis</span>, <span class="st">"armsecukinumab &gt; 0"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">post_secukinumab</span> <span class="op">&lt;-</span> <span class="fu"><a href="postmix.html">postmix</a></span><span class="op">(</span><span class="fu"><a href="mixbeta.html">mixbeta</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, r<span class="op">=</span><span class="fl">15</span>, n<span class="op">=</span><span class="fl">24</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">post_placebo</span>     <span class="op">&lt;-</span> <span class="fu"><a href="postmix.html">postmix</a></span><span class="op">(</span><span class="va">map_AS_beta</span>, r<span class="op">=</span><span class="fl">1</span>, n<span class="op">=</span><span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="mixdiff.html">pmixdiff</a></span><span class="op">(</span><span class="va">post_secukinumab</span>,  <span class="va">post_placebo</span>, <span class="fl">0</span>, lower.tail<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># The posterior probability for a positive treatment effect</span></span></span>
<span class="r-in"><span><span class="co"># is very close to unity in both cases.</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Sebastian Weber.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

